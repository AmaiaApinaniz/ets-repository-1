<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="c837298f-a10e-42d1-88f2-f1415cbbb463" activeEnvironment="Default" name="Conformance Class: Discovery Service - CSW Core" resourceRoot="" soapui-version="5.4.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:description>This test suite examines an OGC Discovery Service against the requirements related to INSPIRE</con:description><con:settings/><con:testSuite id="0c3e1720-dbdf-4970-bb85-f00c3bd75ff1" name="Initialize"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="27dc63e3-a8c0-443f-9261-68573c84b2ef" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="initial-testcase" searchProperties="true"><con:settings/><con:testStep type="groovy" name="reset-properties" id="2979a0fa-4a5f-4cef-83a5-4bc99703a638"><con:settings/><con:config><script>testRunner.testCase.testSuite.project.setPropertyValue( 'extended_capabilities_scenario', '1' );
testRunner.testCase.testSuite.project.setPropertyValue( 'lastServiceEndpoint', '');
testRunner.testCase.testSuite.project.setPropertyValue( 'getrecords_endpoint', '');
testRunner.testCase.testSuite.project.testSuites['Language_Requirements'].testCases['at-26-language-natural-fields-default'].setPropertyValue('language', '');
testRunner.testCase.testSuite.project.testSuites['Language_Requirements'].testCases['at-26-language-natural-fields-default'].testSteps['http-request-languaged'].setDisabled(true);
</script></con:config></con:testStep><con:testStep type="httprequest" name="http-request" id="2ea74ad1-db3b-461d-9a4c-685af9ad7a8f"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="b2a323da-3fa1-42d9-9f3b-fbad043f45b9" name="http-request" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#serviceEndpoint}</con:endpoint><con:request/><con:assertion type="Response SLA Assertion" id="5c8bff0a-38ec-43ca-bc14-66ba6774ac6e" name="Response SLA"><con:configuration><SLA>60000</SLA></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="4177027b-934a-4db4-a913-2a9ee88b8c59" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="OwsExceptionReportAssertion" id="5d1cf02e-c04d-4cb3-bb59-c1b0da724773" name="Fail if service returns OWS Exception Report"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>service</con:name><con:value>${#Project#service}</con:value><con:style>QUERY</con:style><con:default>${#Project#service}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>request</con:name><con:value>GetCapabilities</con:value><con:style>QUERY</con:style><con:default>GetCapabilities</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>version</con:name><con:value>${#Project#version}</con:value><con:style>QUERY</con:style><con:default>${#Project#AcceptVersions}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="groovy" name="set-extended-capabilities-scenario" id="f3fec736-1ec7-4263-9697-eaead5fbf05e"><con:settings/><con:config><script>def response = context.expand('${http-request#Response}');
def capabilities = new XmlSlurper().parseText(response);
def extendedCapabilities = capabilities.depthFirst().findAll{it.name() == 'ExtendedCapabilities' &amp;&amp; it.parent().name() == 'OperationsMetadata'}[0];
def scenario = '1';
testRunner.testCase.testSuite.project.setPropertyValue('extended_capabilities_scenario', scenario);
if(extendedCapabilities.ResourceType.size() == 1 ||
   extendedCapabilities.SpatialDataServiceType.size() == 1 ||
   extendedCapabilities.MandatoryKeyword.size() == 1 ||
   extendedCapabilities.Conformity.size() == 1 ||
   extendedCapabilities.MetadataPointOfContact.size() == 1 ||
   extendedCapabilities.MetadataDate.size() == 1){
	scenario = '2';
	testRunner.testCase.testSuite.project.setPropertyValue('extended_capabilities_scenario', scenario);
}
log.info('Extended Capabilities Scenario: ' + scenario);
</script></con:config></con:testStep><con:testStep type="groovy" name="set-lastserviceendpoint" id="398c931c-7439-45ca-be08-4ed973529c52"><con:settings/><con:config><script>def lastServiceEndpoint = context.expand('${http-request#EndPoint}');
testRunner.testCase.testSuite.project.setPropertyValue( 'lastServiceEndpoint', lastServiceEndpoint);
</script></con:config></con:testStep><con:testStep type="groovy" name="set-getrecords-endpoint" id="2614132e-f987-4b23-8ad7-55cf3a209204"><con:settings/><con:config><script>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def operation = capabilities.depthFirst().findAll{it.name() == 'Operation' &amp;&amp; it.'@name' == 'GetRecords' &amp;&amp; it.parent().name() == 'OperationsMetadata'}[0];

def getrecords_endpoint = operation.DCP.HTTP.Get.'@xlink:href';

testRunner.testCase.testSuite.project.setPropertyValue( 'getrecords_endpoint', getrecords_endpoint.toString());
</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="c2bf56ae-2544-4b9d-9fdf-28654aa6111f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="check-initial-testcase" searchProperties="true"><con:settings/><con:testStep type="groovy" name="run-initial-testcase-if-needed" id="832adc57-d05d-46a7-a631-4058a843a114"><con:settings/><con:config><script>def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def serviceEndPoint = testRunner.testCase.testSuite.project.getPropertyValue('serviceEndpoint');
def lastServiceEndPoint = testRunner.testCase.testSuite.project.getPropertyValue('lastServiceEndpoint');
def makeInitialRequest = false;
if (tc.getTestStepByName("http-request").getPropertyValue("Response") == null){
	makeInitialRequest = true;
}
else if(serviceEndPoint != lastServiceEndPoint){
	makeInitialRequest = true;
}
if(makeInitialRequest){
	runner = tc.run(new com.eviware.soapui.support.types.StringToObjectMap(), false);
}
</script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="f9acf29f-1355-4c5b-9739-2084c4adebc7" name="Discovery_Service_Operations"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="afe7b0dd-4860-42c2-9d01-d08a30b77e52" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-07-extended-capabilities" searchProperties="true"><con:description><![CDATA[<p>Test that the service provides the INSPIRE extended metadata.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-07-extended-capabilities.md" target="_blank">Extended Capabilities</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="dc4dae02-372f-4655-9642-75eb0fe0f447"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="check-extended-capabilities" id="d284a466-cac4-49b2-9add-5828fea243dc"><con:settings/><con:config><script>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");

def capabilities = new XmlSlurper(false, true).parseText(response);
def extendedCapabilities = capabilities.OperationsMetadata.ExtendedCapabilities;
def scenario = testRunner.testCase.testSuite.project.getPropertyValue( "extended_capabilities_scenario").toInteger();

if(extendedCapabilities.size() == 0){
	throw new TranslatableAssertionError('TR.extendedCapabilitiesShallBeProvided');
}
else if(extendedCapabilities.size() > 1){
	String[] assertParams = ['element', 'ExtendedCapabilities'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
else{
	if(scenario == 1){
		if(extendedCapabilities.MetadataUrl.size() > 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/MetadataUrl'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeZeroOrOne', assertParams);
		}
		if(extendedCapabilities.MetadataUrl.URL.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/MetadataUrl/URL'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.MetadataUrl.URL.toString().length() == 0){
			String[] assertParams = ['element', 'ExtendedCapabilities/MetadataUrl'];
			throw new TranslatableAssertionError('TR.valueShallNotBeEmpty', assertParams);
		}
		else{
			def regEx1 = /(http|ftp|https):\/\/([\w+?\.\w+])+([a-zA-Z0-9\~\!\@\#\$\%\^\&amp;\*\(\)_\-\=\+\\\/\?\.\:\;\'\,]*)?/
			def MetadataUrlReplaced = extendedCapabilities.MetadataUrl.URL.toString().replaceAll(regEx1, '');
			if(MetadataUrlReplaced.size() != 0){
				throw new TranslatableAssertionError('TR.metadataURLNotWellFormed');
			}
		}
		if(extendedCapabilities.SupportedLanguages.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/SupportedLanguages'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.ResponseLanguage.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/ResponseLanguage'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.SpatialDataSetIdentifier.Code.size() == 0){
			String[] assertParams = ['element', 'ExtendedCapabilities/SpatialDataSetIdentifier/Code'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
		}
	}
	else if(scenario == 2){
		if(extendedCapabilities.ResourceType.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/ResourceType'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.SpatialDataServiceType.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/SpatialDataServiceType'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.MandatoryKeyword.KeywordValue.size() == 0){
			String[] assertParams = ['element', 'ExtendedCapabilities/MandatoryKeyword/KeywordValue'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
		}
		if(extendedCapabilities.Conformity.Specification.size() == 0){
			String[] assertParams = ['element', 'ExtendedCapabilities/Conformity/Specification'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
		}
		if(extendedCapabilities.Conformity.Degree.size() == 0){
			String[] assertParams = ['element', 'ExtendedCapabilities/Conformity/Degree'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
		}
		if(extendedCapabilities.MetadataPointOfContact.size() == 0){
			String[] assertParams = ['element', 'ExtendedCapabilities/MetadataPointOfContact'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
		}
		if(extendedCapabilities.MetadataDate.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/MetadataDate'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.SupportedLanguages.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/SupportedLanguages'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
		if(extendedCapabilities.ResponseLanguage.size() != 1){
			String[] assertParams = ['element', 'ExtendedCapabilities/ResponseLanguage'];
			throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
		}
	}
}
</script></con:config></con:testStep><con:testStep type="groovy" name="check-other-mandatory-elements" id="a0fe8d87-4cfe-40c9-ac5f-c66b96842a1b"><con:settings/><con:config><script>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

// ServiceIdentification mandatory elements
def serviceIdentification = capabilities.ServiceIdentification;
if(serviceIdentification.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceIdentification'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
if(serviceIdentification.Title.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceIdentification/Title'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
if(serviceIdentification.Abstract.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceIdentification/Abstract'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
if(serviceIdentification.Fees.size() == 0){
	String[] assertParams = ['element', '/Capabilities/ServiceIdentification/Fees'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
}
if(serviceIdentification.AccessConstraints.size() == 0){
	String[] assertParams = ['element', '/Capabilities/ServiceIdentification/AccessConstraints'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOneOrMore', assertParams);
}

// ServiceProvider mandatory elements
def serviceProvider = capabilities.ServiceProvider;
if(serviceProvider.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceProvider'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
if(serviceProvider.ProviderName.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceProvider/ProviderName'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
if(serviceProvider.ServiceContact.ContactInfo.Address.ElectronicMailAddress.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceProvider/ServiceContact/ContactInfo/Address/ElectronicMailAddress'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
if(serviceProvider.role.size() != 1){
	String[] assertParams = ['element', '/Capabilities/ServiceProvider/role'];
	throw new TranslatableAssertionError('TR.multiplicityShallBeOne', assertParams);
}
</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="88ca47a3-a58d-4e0f-848f-392faf695f07" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-12-discover-resource-matching-query" searchProperties="true"><con:description><![CDATA[<p>Test that the Discover Metadata response contains at least the INSPIRE metadata elements.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-12-discover-resource-matching-query.md" target="_blank">Discover Resource Matching Query</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="26403505-df57-44d1-9719-27d8633db877"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="httprequest" name="http-getrecords" id="9a580e6c-4634-453e-93f0-6635cfa94ddb"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="9b082eb2-2684-4b13-8895-788780c3f8a0" name="http-getrecords" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#getrecords_endpoint}</con:endpoint><con:request/><con:assertion type="Response SLA Assertion" id="fc15edb2-9b9d-4678-a757-7a8b55ffe455" name="Response SLA"><con:configuration><SLA>60000</SLA></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="60a2a91d-2a2d-446a-9390-e3377162b38d" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="OwsExceptionReportAssertion" id="7928c5bd-4e32-45d2-8168-b12ff0990eec" name="Fail if service returns OWS Exception Report"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter required="false" disableUrlEncoding="false"><con:name>service</con:name><con:value>${#Project#service}</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter required="false" disableUrlEncoding="false"><con:name>request</con:name><con:value>GetRecords</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter required="false" disableUrlEncoding="false"><con:name>version</con:name><con:value>${#Project#version}</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter required="false" disableUrlEncoding="false"><con:name>typeNames</con:name><con:value>csw:Record</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>resultType</con:name><con:value>results</con:value><con:style>QUERY</con:style><con:default>results</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>outputFormat</con:name><con:value>application/xml</con:value><con:style>QUERY</con:style><con:default>application/xml</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>outputSchema</con:name><con:value>http://www.isotc211.org/2005/gmd</con:value><con:style>QUERY</con:style><con:default>http://www.isotc211.org/2005/gmd</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>elementSetName</con:name><con:value>full</con:value><con:style>QUERY</con:style><con:default>full</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>maxRecords</con:name><con:value>1</con:value><con:style>QUERY</con:style><con:default>20</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="40d2cbc1-bbf1-455a-9479-40dbbb2089fa" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-15-link-publish-metadata-operation" searchProperties="true"><con:description><![CDATA[<p>Test that discovery client approach is implemented properly.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-15-link-publish-metadata-operation.md" target="_blank">Link Publish Metadata Operation</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="782e615e-e922-4d8f-9acc-09489596fb70"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="2a8dd1b2-1ea8-4d27-b5c3-f57649516631" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-16-link-federated-capabilities-document" searchProperties="true"><con:description><![CDATA[<p>Test that federated Discovery Service are plublished in capabilities document.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-16-link-federated-capabilities-document.md" target="_blank">Link Federated Capabilities Document</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="6483324c-67a7-4d14-9e48-fdb3c365e039"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="8ce70701-2ddd-4431-b1bc-dae67bf06799" name="Discovery_Service_Queryable"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="3b4f5f9b-26b8-4d4d-bd98-9f8c50a7d78b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-19-query-search-criteria" searchProperties="true"><con:description><![CDATA[<p>Test that the Discover Metadata service supports queryables.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-19-query-search-criteria.md" target="_blank">Query Search Criteria</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="fdc82c92-1085-434a-95cc-9d85eb68a6ac"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="fa3c3fe2-c050-4ab9-a30f-c280577982fd" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-20-query-language-parameter" searchProperties="true"><con:description><![CDATA[<p>Test that the Discover Metadata service accepts the language parameter.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-20-query-language-parameter.md" target="_blank">Query Language Parameter</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="10724f49-3a92-49d6-bf9e-9374002f68ca"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="check-queryable-parameter-language" id="605289a0-d6a5-423d-b5a7-5de1df1ea90f"><con:settings/><con:config><script>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def operation = capabilities.depthFirst().findAll{it.name() == 'Operation' &amp;&amp; it.'@name' == 'GetRecords' &amp;&amp; it.parent().name() == 'OperationsMetadata'}[0];

def language_supported = false;
for (i in operation.Constraint){
	if(i."@name" == "SupportedISOQueryables"){
		for (j in i.Value){
			if(j.toString() == "Language"){
				language_supported = true;
			}
		}
	}
}

if(!language_supported){
	String[] assertParams = ['value', 'Language'];
	throw new TranslatableAssertionError('TR.missingSupportedQueryableValue', assertParams);
}
</script></con:config></con:testStep><con:testStep type="httprequest" name="http-getrecords-language" id="8e43352e-18b9-4342-8c8d-bbfc9ea70e33"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="3908e684-b3fc-4e5d-a26a-2fd67d291160" name="http-getrecords-language" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#getrecords_endpoint}</con:endpoint><con:request/><con:assertion type="Response SLA Assertion" id="9d0032ee-0337-4956-85df-b139f78298fe" name="Response SLA"><con:configuration><SLA>60000</SLA></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="23c81308-4119-4651-a0bf-9c7322e72ff6" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="OwsExceptionReportAssertion" id="6070e063-4b5e-4990-ae90-f7d630d3a8c1" name="Fail if service returns OWS Exception Report"/><con:assertion type="GroovyScriptAssertion" id="817a0ded-1979-4901-85b2-b5c88c73a0d6" name="check-getrecords-language-response"><con:configuration><scriptText>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
if(messageExchange.response.responseContent == null){
	throw new TranslatableAssertionError('TR.invalidGetRecordsResponse');
}
def getRecordsResponse = new XmlSlurper(false, true).parseText(messageExchange.response.responseContent);
if(getRecordsResponse.SearchResults.size() != 1){
	throw new TranslatableAssertionError('TR.invalidGetRecordsResponse');
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>service</con:name><con:value>${#Project#service}</con:value><con:style>QUERY</con:style><con:default>${#Project#service}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>request</con:name><con:value>GetRecords</con:value><con:style>QUERY</con:style><con:default>GetRecords</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>version</con:name><con:value>${#Project#version}</con:value><con:style>QUERY</con:style><con:default>${#Project#version}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>typeNames</con:name><con:value>csw:Record</con:value><con:style>QUERY</con:style><con:default>csw:Record</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>resultType</con:name><con:value>results</con:value><con:style>QUERY</con:style><con:default>results</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>outputFormat</con:name><con:value>application/xml</con:value><con:style>QUERY</con:style><con:default>application/xml</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>outputSchema</con:name><con:value>http://www.isotc211.org/2005/gmd</con:value><con:style>QUERY</con:style><con:default/><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>elementSetName</con:name><con:value>full</con:value><con:style>QUERY</con:style><con:default>full</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>maxRecords</con:name><con:value>10</con:value><con:style>QUERY</con:style><con:default>10</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>constraintLanguage</con:name><con:value>CQL_TEXT</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>constraint_language_version</con:name><con:value>1.1.0</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>constraint</con:name><con:value>language = 'eng'</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="dce42f1a-2694-4b8d-bee9-6b26af1e0a3c" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-21-query-additional-parameters" searchProperties="true"><con:description><![CDATA[<p>Test that the Discover Metadata service supports additional queryables.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-21-query-additional-parameters.md" target="_blank">Query Additional Parameters</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="ec79067e-6a9e-4168-878a-ceea91f1ef61"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="2d49ae6c-7d6a-4f7c-9a35-611b2a4f5bae" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-22-query-parameters-advertised" searchProperties="true"><con:description><![CDATA[<p>Test that all ISO and additional queryables are advertised in the capabilities document.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-22-query-parameters-advertised.md" target="_blank">Query Parameters Advertised</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="5c7dcf42-4650-42c1-822f-a23330f9359f"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="check-queryable-parameters" id="ba056249-f522-41c6-a704-59efee3ae311"><con:settings/><con:config><script><![CDATA[import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def supportedISOQueryablesValues = capabilities.OperationsMetadata.Operation.depthFirst().findAll{it.name() == 'Value' &&
																		it.parent().name() == 'Constraint' && 
																		it.parent().'@name' == 'SupportedISOQueryables' && 
																		it.parent().parent().'@name' == 'GetRecords'};

def mandatoryValues = ['Subject', 'TopicCategory', 'ServiceType', 'SpatialResolution', 'BoundingBox', 'OrganisationName', 'Title', 'Abstract', 'Type', 
					'ResourceIdentifier', 'TemporalExtent', 'PublicationDate', 'RevisionDate', 'CreationDate'];
def missingValues = [];

for (i in mandatoryValues){
	if (supportedISOQueryablesValues.findAll{it == i}.size() == 0){
		missingValues << i;
	}
}

if (missingValues.size() != 0){
	String[] assertParams = ['value', missingValues.join(", ")];
	throw new TranslatableAssertionError('TR.missingSupportedQueryableValue', assertParams);
}
]]></script></con:config></con:testStep><con:testStep type="groovy" name="check-additional-queryable-parameters" id="c22ad89b-2858-4ab1-8ea1-0599f1903507"><con:settings/><con:config><script><![CDATA[import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def additionalQueryablesValues = capabilities.OperationsMetadata.Operation.depthFirst().findAll{it.name() == 'Value' &&
																		it.parent().name() == 'Constraint' && 
																		it.parent().'@name' == 'AdditionalQueryables' && 
																		it.parent().parent().'@name' == 'GetRecords'};

def mandatoryValues = ['Degree', 'Specification', 'LimitationsOnPublicAccess', 'ConditionApplyingToAccessAndUse', 'Lineage', 'ResponsiblePartyRole',
					'SpecificationTitle', 'SpecificationDate', 'SpecificationDateType', 'AccessConstraints', 'OtherConstraints', 'Classification'];
def missingValues = [];

for (i in mandatoryValues){
	if (additionalQueryablesValues.findAll{it == i}.size() == 0){
		missingValues << i;
	}
}

if (missingValues.size() != 0){
	String[] assertParams = ['value', missingValues.join(", ")];
	throw new TranslatableAssertionError('TR.missingAdditionalQueryableValue', assertParams);
}
]]></script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="4ed5dac2-d800-4ecb-bec7-c85799ec1ea7" name="Language_Requirements"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="0340ec22-fc88-44ea-9025-b8ad687ab148" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-24-language-natural-lang-fields" searchProperties="true"><con:description><![CDATA[<p>Test that natural language fields vary depending on the requested language.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-24-language-natural-lang-fields.md" target="_blank">Language Natural Language Fields</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="145e2373-3f63-4a85-af1e-0de351f7aa5f"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="2cc39a22-33b0-432c-b4f3-f9fca0d7fa84" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-25-language-parameter-iso-valid" searchProperties="true"><con:description><![CDATA[<p>Test that the service support the parameter LANGUAGE.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-25-language-parameter-iso-valid.md" target="_blank">Language Parameter ISO valid</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="9b36898f-b5d5-4c57-b75f-349172018bd0"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="check-language-parameter-iso" id="183ce8bd-e375-4158-9fca-ac8b2fc1e48a"><con:settings/><con:config><script><![CDATA[import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def responseLanguage = capabilities.OperationsMetadata.ExtendedCapabilities.ResponseLanguage.Language;
def defaultLanguage = capabilities.OperationsMetadata.ExtendedCapabilities.SupportedLanguages.DefaultLanguage.Language;
def supportedLanguage = capabilities.OperationsMetadata.ExtendedCapabilities.SupportedLanguages.SupportedLanguage.Language;

def isoLang = ['aar', 'abk', 'ace', 'ach', 'ada', 'ady', 'afa', 'afh', 'afr', 'ain', 'aka', 'akk', 'alb', 'ale', 'alg', 'alt', 'amh', 'ang', 'anp', 'apa', 'ara', 'arc', 'arg', 'arm', 'arn', 'arp', 'art', 'arw', 'asm', 'ast', 'ath', 'aus', 'ava', 'ave', 'awa', 'aym', 'aze', 'bad', 'bai', 'bak', 'bal', 'bam', 'ban', 'baq', 'bas', 'bat', 'bej', 'bel', 'bem', 'ben', 'ber', 'bho', 'bih', 'bik', 'bin', 'bis', 'bla', 'bnt', 'bos', 'bra', 'bre', 'btk', 'bua', 'bug', 'bul', 'bur', 'byn', 'cad', 'cai', 'car', 'cat', 'cau', 'ceb', 'cel', 'cha', 'chb', 'che', 'chg', 'chi', 'chk', 'chm', 'chn', 'cho', 'chp', 'chr', 'chu', 'chv', 'chy', 'cmc', 'cnr', 'cop', 'cor', 'cos', 'cpe', 'cpf', 'cpp', 'cre', 'crh', 'crp', 'csb', 'cus', 'cze', 'dak', 'dan', 'dar', 'day', 'del', 'den', 'dgr', 'din', 'div', 'doi', 'dra', 'dsb', 'dua', 'dum', 'dut', 'dyu', 'dzo', 'efi', 'egy', 'eka', 'elx', 'eng', 'enm', 'epo', 'est', 'ewe', 'ewo', 'fan', 'fao', 'fat', 'fij', 'fil', 'fin', 'fiu', 'fon', 'fre', 'frm', 'fro', 'frr', 'frs', 'fry', 'ful', 'fur', 'gaa', 'gay', 'gba', 'gem', 'geo', 'ger', 'gez', 'gil', 'gla', 'gle', 'glg', 'glv', 'gmh', 'goh', 'gon', 'gor', 'got', 'grb', 'grc', 'gre', 'grn', 'gsw', 'guj', 'gwi', 'hai', 'hat', 'hau', 'haw', 'heb', 'her', 'hil', 'him', 'hin', 'hit', 'hmn', 'hmo', 'hrv', 'hsb', 'hun', 'hup', 'iba', 'ibo', 'ice', 'ido', 'iii', 'ijo', 'iku', 'ile', 'ilo', 'ina', 'inc', 'ind', 'ine', 'inh', 'ipk', 'ira', 'iro', 'ita', 'jav', 'jbo', 'jpn', 'jpr', 'jrb', 'kaa', 'kab', 'kac', 'kal', 'kam', 'kan', 'kar', 'kas', 'kau', 'kaw', 'kaz', 'kbd', 'kha', 'khi', 'khm', 'kho', 'kik', 'kin', 'kir', 'kmb', 'kok', 'kom', 'kon', 'kor', 'kos', 'kpe', 'krc', 'krl', 'kro', 'kru', 'kua', 'kum', 'kur', 'kut', 'lad', 'lah', 'lam', 'lao', 'lat', 'lav', 'lez', 'lim', 'lin', 'lit', 'lol', 'loz', 'ltz', 'lua', 'lub', 'lug', 'lui', 'lun', 'luo', 'lus', 'mac', 'mad', 'mag', 'mah', 'mai', 'mak', 'mal', 'man', 'mao', 'map', 'mar', 'mas', 'may', 'mdf', 'mdr', 'men', 'mga', 'mic', 'min', 'mis', 'mkh', 'mlg', 'mlt', 'mnc', 'mni', 'mno', 'moh', 'mon', 'mos', 'mul', 'mun', 'mus', 'mwl', 'mwr', 'myn', 'myv', 'nah', 'nai', 'nap', 'nau', 'nav', 'nbl', 'nde', 'ndo', 'nds', 'nep', 'new', 'nia', 'nic', 'niu', 'nno', 'nob', 'nog', 'non', 'nor', 'nqo', 'nso', 'nub', 'nwc', 'nya', 'nym', 'nyn', 'nyo', 'nzi', 'oci', 'oji', 'ori', 'orm', 'osa', 'oss', 'ota', 'oto', 'paa', 'pag', 'pal', 'pam', 'pan', 'pap', 'pau', 'peo', 'per', 'phi', 'phn', 'pli', 'pol', 'pon', 'por', 'pra', 'pro', 'pus', 'qaa-qtz', 'que', 'raj', 'rap', 'rar', 'roa', 'roh', 'rom', 'rum', 'run', 'rup', 'rus', 'sad', 'sag', 'sah', 'sai', 'sal', 'sam', 'san', 'sas', 'sat', 'scn', 'sco', 'sel', 'sem', 'sga', 'sgn', 'shn', 'sid', 'sin', 'sio', 'sit', 'sla', 'slo', 'slv', 'sma', 'sme', 'smi', 'smj', 'smn', 'smo', 'sms', 'sna', 'snd', 'snk', 'sog', 'som', 'son', 'sot', 'spa', 'srd', 'srn', 'srp', 'srr', 'ssa', 'ssw', 'suk', 'sun', 'sus', 'sux', 'swa', 'swe', 'syc', 'syr', 'tah', 'tai', 'tam', 'tat', 'tel', 'tem', 'ter', 'tet', 'tgk', 'tgl', 'tha', 'tib', 'tig', 'tir', 'tiv', 'tkl', 'tlh', 'tli', 'tmh', 'tog', 'ton', 'tpi', 'tsi', 'tsn', 'tso', 'tuk', 'tum', 'tup', 'tur', 'tut', 'tvl', 'twi', 'tyv', 'udm', 'uga', 'uig', 'ukr', 'umb', 'und', 'urd', 'uzb', 'vai', 'ven', 'vie', 'vol', 'vot', 'wak', 'wal', 'war', 'was', 'wel', 'wen', 'wln', 'wol', 'xal', 'xho', 'yao', 'yap', 'yid', 'yor', 'ypk', 'zap', 'zbl', 'zen', 'zgh', 'zha', 'znd', 'zul', 'zun', 'zxx', 'zza'];
def notSupportedLanguage = [];

if(!(responseLanguage.toString() in isoLang)){
	notSupportedLanguage << responseLanguage.toString();
}
if(!(defaultLanguage.toString() in isoLang)){
	notSupportedLanguage << defaultLanguage.toString();
}
for (i in supportedLanguage){
	if(!(i.toString() in isoLang)){
		notSupportedLanguage << i.toString();
	}
}
if(notSupportedLanguage.size() != 0){
	String[] assertParams = ['language', notSupportedLanguage.join(", ")];
	throw new TranslatableAssertionError('TR.languagesNotISO', assertParams);
}
]]></script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="027e7c14-b1ba-41d0-b39f-92c27fab80e4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-26-language-natural-fields-default" searchProperties="true"><con:description><![CDATA[<p>Test that natural language fields are provided in default language when requested language is unsupported or absent.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-26-language-natural-fields-default.md" target="_blank">Language Natural Fields Default</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="d5d4644d-59e6-492c-8bbf-32575822b69b"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="set-default-language" id="326be7ea-a49e-4cd8-bdb6-ec2fc58d4340"><con:settings/><con:config><script>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def defaultLanguage = capabilities.OperationsMetadata.ExtendedCapabilities.SupportedLanguages.DefaultLanguage.Language;

testRunner.testCase.setPropertyValue('language', defaultLanguage.toString());</script></con:config></con:testStep><con:testStep type="httprequest" name="http-request-languaged" id="9976cc08-d1d1-4bed-9592-0dd8a0966ac1" disabled="true"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="46506327-bd99-442d-ba3e-fca3b3617cf8" name="http-request-languaged" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#serviceEndpoint}</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>service</con:name><con:value>${#Project#service}</con:value><con:style>QUERY</con:style><con:default>${#Project#service}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>request</con:name><con:value>GetCapabilities</con:value><con:style>QUERY</con:style><con:default>GetCapabilities</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>version</con:name><con:value>${#Project#version}</con:value><con:style>QUERY</con:style><con:default>${#Project#version}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>language</con:name><con:value>${#TestCase#language}</con:value><con:style>QUERY</con:style><con:default>${#TestCase#language}</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="groovy" name="check-capabilities-languaged" id="5258e920-086a-4307-a7c9-227a3d23f1a3"><con:settings/><con:config><script>import de.interactive_instruments.etf.suim.TranslatableAssertionError;
def tc = testRunner.testCase.testSuite.project.testSuites["Initialize"].testCases["initial-testcase"];
def response = tc.getTestStepByName("http-request").getPropertyValue("Response");
def capabilities = new XmlSlurper(false, true).parseText(response);

def defaultTitle = capabilities.ServiceIdentification.Title.toString();
def defaultAbstract = capabilities.ServiceIdentification.Abstract.toString();

def languages_to_request = [];
languages_to_request &lt;&lt; capabilities.OperationsMetadata.ExtendedCapabilities.SupportedLanguages.DefaultLanguage.Language;
languages_to_request &lt;&lt; 'zzz';

def ts = testRunner.testCase.testSuite.project.testSuites["Language_Requirements"].testCases["at-26-language-natural-fields-default"].getTestStepByName('http-request-languaged');
for (i in languages_to_request){
	testRunner.testCase.setPropertyValue('language', i.toString());
	ts.setDisabled(false);
	ts.run(testRunner, context);
	def validContentType = false;
	for (j in ts.testRequest.response.responseHeaders.get('Content-Type')){
		if (j.contains('xml')){
			validContentType = true;
		}
	}
	if(!validContentType){
		throw new TranslatableAssertionError("TR.notXMLResponse");
	}
	def capabilitiesLanguaged = new XmlSlurper(false, true).parseText(ts.getPropertyValue("Response"));
	if(defaultTitle != capabilitiesLanguaged.ServiceIdentification.Title.toString() || defaultAbstract != capabilitiesLanguaged.ServiceIdentification.Abstract.toString()){
		throw new TranslatableAssertionError("TR.reponseTitleAbstractShallBeDefault");
	}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>language</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="3f6b71ea-b31b-404b-9356-3ada755def9e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-27-language-response-value" searchProperties="true"><con:description><![CDATA[<p>Test that the response language is correct based on the requested language.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-27-language-response-value.md" target="_blank">Language Response Value</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="00533e15-68b4-4871-b9ec-a10259b2b696"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="364fcdc7-28ff-4a0d-b4c7-fceeed81f406" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-28-language-supported-default-cardinality" searchProperties="true"><con:description><![CDATA[<p>Test that the cardinality of supported languages is correct.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-28-language-supported-default-cardinality.md" target="_blank">Language Supported Default Cardinality</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="37a81548-14d1-4bed-8936-a1b39c83a7a7"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="ed17066c-0557-4428-a72a-e0bbe7dba5e1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-29-extended-capabilities-schema-valid" searchProperties="true"><con:description><![CDATA[<p>Test that the capabilities document is schema valid.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-29-extended-capabilities-schema-valid.md" target="_blank">Extended Capabilities Schema Valid</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="3479e631-9ac4-44e2-955c-6e62f5c9e35a"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="9e3b0ac3-5909-437b-9017-8338a6fc89d6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-30-language-getrecords-without-parameter" searchProperties="true"><con:description><![CDATA[<p>Test the service behaviour without a language specific filter.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-30-language-getrecords-without-parameter.md" target="_blank">Language GetRecords without Parameter</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="e8f62b85-dcf8-473a-ae4a-78ce385f202a"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="50c8af6f-8bf0-4b81-9a1e-105b0cbc579e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-31-language-getrecords-lang-filter" searchProperties="true"><con:description><![CDATA[<p>Test that the service supports filtering by language.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-31-language-getrecords-lang-filter.md" target="_blank">Language GetRecords Language Filter</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="7937ffd9-d019-47ef-ab6e-bedfc939436d"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="95597eca-45eb-4105-8e82-837b87263155" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="at-32-language-getrecords-exception" searchProperties="true"><con:description><![CDATA[<p>Test that GetRecords exceptions are provided in the correct language.</p>
<p>More information: <a href="https://github.com/inspire-eu-validation/discovery-service/blob/review-ats-csw-3.1/csw-iso-ap/at-32-language-getrecords-exception.md" target="_blank">Language GetRecords Exception</a></p>]]></con:description><con:settings/><con:testStep type="testcasedependency" name="check-initial-testcase" id="917a09f7-083b-492e-902a-83dfaae48689"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c2bf56ae-2544-4b9d-9fdf-28654aa6111f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:properties><con:property><con:name>serviceEndpoint</con:name><con:value>http://www.idee.es/csw-codsi-idee/srv/spa/csw?Request=GetCapabilities&amp;Service=CSW</con:value></con:property><con:property><con:name>service</con:name><con:value>CSW</con:value></con:property><con:property><con:name>version</con:name><con:value>2.0.2</con:value></con:property><con:property><con:name>extended_capabilities_scenario</con:name><con:value>1</con:value></con:property><con:property><con:name>lastServiceEndpoint</con:name><con:value/></con:property><con:property><con:name>getrecords_endpoint</con:name><con:value/></con:property><con:property><con:name>authUser</con:name><con:value/></con:property><con:property><con:name>authPwd</con:name><con:value/></con:property><con:property><con:name>authMethod</con:name><con:value/></con:property><con:property><con:name>etf.ignore.properties</con:name><con:value>service, version, lastServiceEndpoint, getrecords_endpoint, authUser, authPwd, authMethod</con:value></con:property><con:property><con:name>etf.tag.ids</con:name><con:value>EID0861e71d-bb54-4fa2-8d32-816b41531da3</con:value></con:property><con:property><con:name>etf.translation.template.collection.id</con:name><con:value>EID6f004d02-ca77-4a67-99a4-62515725a573</con:value></con:property><con:property><con:name>etf.supported.test.object.type.ids</con:name><con:value>EID4b0fb35d-10f0-47df-bc0b-6d4548035ae2</con:value></con:property><con:property><con:name>etf.author</con:name><con:value>Consortium Bilbomatica, Guadaltel &amp; Geograma</con:value></con:property><con:property><con:name>etf.creation.date</con:name><con:value>2019-05-02T10:00:00</con:value></con:property><con:property><con:name>etf.last.editor</con:name><con:value>Consortium Bilbomatica, Guadaltel &amp; Geograma</con:value></con:property><con:property><con:name>etf.last.update.date</con:name><con:value>2019-05-09T13:00:00</con:value></con:property><con:property><con:name>etf.version</con:name><con:value>0.0.2</con:value></con:property><con:property><con:name>etf.reference</con:name><con:value>https://github.com/inspire-eu-validation/discovery-service</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>